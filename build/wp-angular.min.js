angular.module("wp",["wp.services","ngResource","ngSanitize"]).directive("havePosts",["WP",function(e){return{restrict:"E",replace:!0,transclude:!0,scope:{postType:"@",postId:"@",apiRoot:"@",perPage:"@",offset:"@",filter:"="},controller:["$scope",function(t){t.load=function(){t.query!=t.last_query&&(t.last_query=t.query,t.postId?e.Query(t.apiRoot).get(t.query).$promise.then(function(e){t.posts.push(e)}):e.Query(t.apiRoot).query(t.query).$promise.then(function(e){e.length&&(t.posts=t.posts.concat(e),t.last_query={},t.query.offset=parseInt(t.query.offset)+parseInt(t.perPage))}))}}],compile:function(t,r,i){return{pre:function(t,r,i,n){if(t.posts=[],t.postId)t.query={endpoint:t.postType,id:t.postId};else{t.perPage||(t.perPage=10),t.offset||(t.offset=0);var s={endpoint:t.postType,per_page:t.perPage,offset:t.offset,"filter[orderby]":"date","filter[order]":"DESC",_embed:!0};t.query=angular.extend(s,e.parseFilters(t.filter))}t.load()}}},link:function(t){t.$watch("filter",function(r){t.posts=[],scope.query=angular.extend(scope.query,e.parseFilters(r)),scope.load()})},template:function(e,t){try{if(angular.module("infinite-scroll"))return'<div class="have-posts"><div infinite-scroll="load()" infinite-scroll-distance="2"><article class="{{ postType }} post-{{ post.id }}" ng-repeat="post in posts"><div ng-transclude></div></article></div></div>'}catch(r){try{if(angular.module("ionic"))return'<div class="have-posts"><article class="{{ postType }} post-{{ post.id }}" ng-repeat="post in posts"><div ng-transclude></div></article></div><ion-infinite-scrollon-infinite="load()"distance="10%"></ion-infinite-scroll>'}catch(r){return'<div class="have-posts"><article class="{{ postType }} post-{{ post.id }}" ng-repeat="post in posts"><div ng-transclude></div></article></div>'}}}}}]).directive("theTitle",["$sce",function(e){return{restrict:"E",replace:!0,require:"^havePosts",transclude:!0,compile:function(e,t,r){return{post:function(e,r,i,n){var s=e.$parent.post;e.title=s.title.rendered,t.href?(e.permalink=t.href,e.permalink=e.permalink.replace(":id",s.id),e.permalink=e.permalink.replace(":slug",s.slug)):e.permalink=""}}},template:function(e,t){return t.href?'<div class="the-title"><a ng-href="{{ permalink }}" ng-bind-html="title">{{ title }}</a></div>':'<div class="the-title" ng-bind-html="title">{{ title }}</div>'}}}]).directive("theContent",["$sce",function(e){return{restrict:"E",replace:!0,require:"^havePosts",compile:function(t,r,i){return{post:function(t,r,i,n){var s=t.$parent.post;t.content=e.trustAsHtml(s.content.rendered)}}},template:'<div class="the-content" ng-bind-html="content">{{ content }}</div>'}}]).directive("thePostThumbnail",[function(){return{restrict:"E",replace:!0,require:"^havePosts",compile:function(e,t,r){return{post:function(e,r,i,n){i.size||(i.size="post-thumbnail");var s,o="https://api.w.org/featuredmedia",a=e.$parent.post._embedded;a&&a[o]&&a[o].length&&(s=a[o][0].media_details.sizes[i.size]?a[o][0].media_details.sizes[i.size].source_url:a[o][0].media_details.sizes.full.source_url),s&&(e.image_src=s);var p=e.$parent.post;t.href?(e.permalink=t.href,e.permalink=e.permalink.replace(":id",p.id),e.permalink=e.permalink.replace(":slug",p.slug)):e.permalink=""}}},template:function(e,t){return t.href?'<div class="the-post-thumbnail"><a ng-href="{{ permalink }}"><img ng-src="{{ image_src }}"></a></div>':'<div class="the-post-thumbnail"><img ng-src="{{ image_src }}"></div>'}}}]).directive("theId",[function(){return{restrict:"E",replace:!0,require:"^havePosts",compile:function(e,t,r){return{post:function(e,t,r,i){e.post_id=e.$parent.post.id}}},template:'<div class="the-id">{{ post_id }}</div>'}}]).directive("theExcerpt",["$sce",function(e){return{restrict:"E",replace:!0,require:"^havePosts",compile:function(t,r,i){return{post:function(t,r,i,n){var s=t.$parent.post;t.excerpt=e.trustAsHtml(s.excerpt.rendered)}}},template:'<div class="the-excerpt" ng-bind-html="excerpt">{{ excerpt }}</div>'}}]).directive("theDate",[function(){return{restrict:"E",replace:!0,require:"^havePosts",compile:function(e,t,r){return{post:function(e,t,r,i){r.format?e.format=r.format:e.format="yyyy/MM/ddTH:mm:ssZ";var n=e.$parent.post.date_gmt+"Z";e.date=n}}},template:'<div class="the-date">{{ date | date: format }}</div>'}}]),angular.module("wp.services",["ngResource"]).service("WP",["$resource",function(e){this.Query=function(t){var r=t+"/:endpoint/:id",i={endpoint:"@endpoint",id:"@id"},n={};return e(r,i,n)},this.parseFilters=function(e){var t={};for(var r in e)t["filter["+r+"]"]=e[r];return t}}]);